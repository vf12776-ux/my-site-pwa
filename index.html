<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Croissant77</title>
    
    <!-- –ù–ê–®–ê –∏–∫–æ–Ω–∫–∞ - –í–°–ï–ì–î–ê -->
    <link rel="icon" href="icons/icon192.png" type="image/png" id="permaFavicon">
    <link rel="shortcut icon" href="icons/icon192.png">
    <link rel="apple-touch-icon" href="icons/icon192.png">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f5576c">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; overflow: hidden; }
        
        #siteContainer {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Overlay –ø–æ–≤–µ—Ä—Ö iframe –¥–ª—è favicon –∑–∞—â–∏—Ç—ã */
        #faviconProtector {
            position: fixed;
            top: -100px;
            left: -100px;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–∞–π—Ç–∞ -->
    <div id="siteContainer">
        <iframe 
            src="about:blank"
            id="siteFrame"
            sandbox="allow-scripts allow-same-origin allow-forms allow-popups"
            title="Croissant77">
        </iframe>
    </div>
    
    <!-- –ù–µ–≤–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ favicon –∏–∑–º–µ–Ω–µ–Ω–∏—è -->
    <div id="faviconProtector"></div>

    <script>
        // 1. –Ø–î–ï–†–ù–ê–Ø –ë–õ–û–ö–ò–†–û–í–ö–ê FAVICON –ò–ó–ú–ï–ù–ï–ù–ò–ô
        function nuclearFaviconLock() {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –í–°–ï –ø–æ–ø—ã—Ç–∫–∏ –∏–∑–º–µ–Ω–∏—Ç—å favicon
            const originalHeadAppendChild = document.head.appendChild;
            const originalHeadInsertBefore = document.head.insertBefore;
            const originalHeadReplaceChild = document.head.replaceChild;
            
            document.head.appendChild = function(node) {
                if (node.rel && node.rel.includes('icon')) {
                    console.log('üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å favicon —á–µ—Ä–µ–∑ appendChild');
                    return node; // –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º
                }
                return originalHeadAppendChild.call(this, node);
            };
            
            document.head.insertBefore = function(newNode, referenceNode) {
                if (newNode.rel && newNode.rel.includes('icon')) {
                    console.log('üö´ –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ –∏–∑–º–µ–Ω–∏—Ç—å favicon —á–µ—Ä–µ–∑ insertBefore');
                    return newNode;
                }
                return originalHeadInsertBefore.call(this, newNode, referenceNode);
            };
            
            // –¢–∞–∫–∂–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ DOM
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeName === 'LINK' && 
                            node.rel && 
                            (node.rel.includes('icon') || node.rel.includes('Icon'))) {
                            console.log('üö´ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∏ —É–¥–∞–ª–µ–Ω–∞ –∏–∫–æ–Ω–∫–∞ Craftum');
                            node.remove();
                            
                            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—à—É
                            const ourIcon = document.createElement('link');
                            ourIcon.rel = 'icon';
                            ourIcon.href = 'icons/icon192.png';
                            ourIcon.type = 'image/png';
                            document.head.appendChild(ourIcon);
                        }
                    });
                });
            });
            
            observer.observe(document.head, { childList: true, subtree: true });
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—à–µ–π –∏–∫–æ–Ω–∫–∏
            setInterval(() => {
                const icons = document.querySelectorAll('link[rel*="icon"]');
                let hasOurIcon = false;
                
                icons.forEach(icon => {
                    if (icon.href.includes('icon192.png') || icon.href.includes('my-site-pwa')) {
                        hasOurIcon = true;
                    } else {
                        icon.remove(); // –£–¥–∞–ª—è–µ–º —á—É–∂—É—é
                    }
                });
                
                if (!hasOurIcon) {
                    const newIcon = document.createElement('link');
                    newIcon.rel = 'icon';
                    newIcon.href = 'icons/icon192.png';
                    newIcon.type = 'image/png';
                    document.head.appendChild(newIcon);
                    console.log('üîÑ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞—à–∞ –∏–∫–æ–Ω–∫–∞');
                }
            }, 500);
            
            console.log('üîí –Ø–¥–µ—Ä–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ favicon –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞');
        }
        
        // 2. –ó–ê–ì–†–£–ó–ö–ê –°–ê–ô–¢–ê –í IFRAME
        function loadSite() {
            const frame = document.getElementById('siteFrame');
            
            // –°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É-–ø–æ—Å—Ä–µ–¥–Ω–∏–∫ –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ Craftum JS
            const proxyHtml = `
                <!DOCTYPE html>
                <html>
                <head>
                    <base href="https://croissant77.ru/">
                    <script>
                        // –ë–ª–æ–∫–∏—Ä—É–µ–º Craftum scripts –∫–æ—Ç–æ—Ä—ã–µ –º–µ–Ω—è—é—Ç favicon
                        const blockedScripts = [
                            'favicon', 'icon', 'craftum-favicon',
                            '/assets/', '/static/', '/js/'
                        ];
                        
                        const originalCreateElement = document.createElement;
                        document.createElement = function(tagName) {
                            const element = originalCreateElement.call(document, tagName);
                            
                            if (tagName.toLowerCase() === 'script') {
                                element.addEventListener('load', function() {
                                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ favicon –ª–∏ —ç—Ç–æ –º–µ–Ω—è–µ—Ç
                                    if (this.src && blockedScripts.some(s => this.src.includes(s))) {
                                        console.log('–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω —Å–∫—Ä–∏–ø—Ç:', this.src);
                                        // –ù–µ –¥–∞–µ–º –µ–º—É —Ä–∞–±–æ—Ç–∞—Ç—å
                                    }
                                });
                            }
                            
                            return element;
                        };
                    <\/script>
                </head>
                <body>
                    <iframe 
                        src="https://croissant77.ru/page2" 
                        style="width:100%; height:100vh; border:none;"
                        sandbox="allow-scripts allow-same-origin allow-forms allow-popups">
                    </iframe>
                </body>
                </html>
            `;
            
            frame.srcdoc = proxyHtml;
            
            console.log('üåê –°–∞–π—Ç –∑–∞–≥—Ä—É–∂–µ–Ω —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç favicon –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞');
        }
        
        // 3. PWA –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('‚úÖ PWA –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                .catch(err => console.log('‚ùå PWA –æ—à–∏–±–∫–∞:', err));
        }
        
        // 4. –ó–ê–ü–£–°–ö
        nuclearFaviconLock(); // –ë–ª–æ–∫–∏—Ä—É–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        setTimeout(loadSite, 100); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–∞–π—Ç
        
        // 5. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ó–ê–©–ò–¢–ê - –ü–ï–†–ï–ó–ê–ì–†–£–ó–ö–ê –°–¢–†–ê–ù–ò–¶–´ –ü–†–ò –ü–û–ü–´–¢–ö–ï –°–ú–ï–ù–ò–¢–¨ FAVICON
        let faviconChangeAttempts = 0;
        
        const checkFavicon = setInterval(() => {
            const icons = document.querySelectorAll('link[rel*="icon"]');
            let hasCraftumIcon = false;
            
            icons.forEach(icon => {
                if (icon.href && 
                   (icon.href.includes('craftum') || 
                    (!icon.href.includes('icon192.png') && 
                     !icon.href.includes('my-site-pwa')))) {
                    hasCraftumIcon = true;
                    icon.remove();
                    faviconChangeAttempts++;
                    
                    if (faviconChangeAttempts > 3) {
                        console.log('‚ö° –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ø—ã—Ç–æ–∫ —Å–º–µ–Ω–∏—Ç—å favicon - –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º');
                        window.location.reload();
                    }
                }
            });
        }, 300);
        
    </script>
</body>
</html>